<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DULAS Decoder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(120deg, #11998e, #38ef7d);
      color: white;
      text-align: center;
      padding: 40px;
    }
    .container {
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 15px;
      display: inline-block;
      width: 400px;
    }
    input, select, button {
      margin: 8px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      width: 80%;
    }
    button {
      background: #ff416c;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover { background: #ff4b2b; }
    img { max-width: 200px; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ”“ DULAS Decoder</h1>
    <p>Choose what to decode:</p>
    <select id="decodeType">
      <option value="image">Images</option>
      <option value="audio">Audio</option>
    </select>
    <br>
    <input type="file" id="dlsInput" multiple>
    <br>
    <input type="password" id="password" placeholder="Password (if required)">
    <br>
    <button onclick="decodeFiles()">Decode .dls</button>
    <div id="output"></div>
  </div>

  <script>
    function xorEncryptDecrypt(data, password) {
      let result = "";
      for (let i = 0; i < data.length; i++) {
        result += String.fromCharCode(
          data.charCodeAt(i) ^ password.charCodeAt(i % password.length)
        );
      }
      return result;
    }

    function decodeFiles() {
      const decodeType = document.getElementById("decodeType").value;
      const password = document.getElementById("password").value;
      const files = document.getElementById("dlsInput").files;
      const output = document.getElementById("output");
      output.innerHTML = "";

      if (files.length === 0) {
        alert("Please select at least one .dls file!");
        return;
      }

      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const dlsObj = JSON.parse(reader.result);

            if (dlsObj.dulasType !== decodeType) {
              alert(`This file is not a ${decodeType}!`);
              return;
            }

            let fileContent = dlsObj.content;
            if (dlsObj.passwordProtected) {
              if (!password) {
                alert("This file is password protected. Enter password to decode.");
                return;
              }
              try {
                fileContent = xorEncryptDecrypt(atob(fileContent), password);
              } catch (e) {
                alert("Wrong password or corrupted file!");
                return;
              }
            }

            const link = document.createElement("a");
            link.href = fileContent;
            link.download = dlsObj.fileName;
            link.textContent = `â¬‡ Download ${dlsObj.fileName}`;
            output.appendChild(link);
            output.appendChild(document.createElement("br"));

            if (decodeType === "image") {
              const img = document.createElement("img");
              img.src = fileContent;
              output.appendChild(img);
            } else if (decodeType === "audio") {
              const audio = document.createElement("audio");
              audio.controls = true;
              audio.src = fileContent;
              output.appendChild(audio);
            }
          } catch (err) {
            alert("Invalid DULAS file!");
          }
        };
        reader.readAsText(file);
      });
    }
  </script>
</body>
</html>